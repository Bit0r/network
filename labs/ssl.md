在这个实验中，我们将研究安全套接字层（SSL）协议，重点是通过TCP连接发送的SSL记录。我们将通过分析主机和电子商务服务器之间发送的SSL记录的跟踪来做到这一点。我们将研究各种SSL记录类型以及SSL消息中的字段。你可能想复习课文中的第8.6节。我们目前正在开发一个Wireshark实验室，它将覆盖TLS——在我们的第8版中，它将取代SSL。

![](media/ssl/1.png)

# 在SSL会话中捕获数据包

第一步是在SSL会话中捕获包。要做到这一点，你应该去你最喜欢的电子商务网站购买一件商品（但是在达到实际目的之前就终止！）。在用Wireshark捕获包之后，您应该设置过滤器，以便它只显示主机发送和接收的包含SSL记录的以太网帧（SSL记录与SSL报文是一个意思）。

# 查看捕获的包

Wireshark GUI应该只显示有SSL记录的以太网帧。请记住，一个以太网帧可能包含一个或多个SSL记录。（这与HTTP非常不同，对于HTTP，每个帧都包含一个完整的HTTP消息或HTTP消息的一部分。）此外，一个SSL记录可能无法完全装入一个以太网帧，在这种情况下，需要多个帧来承载记录。

如果可能，在回答下面的问题时，您应该在您用来回答所问问题的跟踪中提交一份数据包的打印输出。在打印件上加上注释，解释你的答案。要打印数据包，请使用*文件->打印*，选择*仅选定数据包*，选择*数据包摘要行*，并选择回答问题所需的最小数据包详细信息

1. 对于前8个以太网帧中的每一个，指定帧的源（客户端或服务器），确定帧中包含的SSL记录数，并列出帧中包含的SSL记录类型。在客户端和服务器之间绘制一个时序图，每个SSL记录有一个箭头。



2. 每个SSL记录都以相同的三个字段开头（可能具有不同的值）。其中一个字段是“内容类型”，长度为1个字节。列出所有三个字段及其长度。

内容类型：1字节\
版本号：2字节\
长度度：2字节

## 客户端 Hello 记录

3. 展开客户端Hello记录。（如果跟踪包含多个客户端Hello记录，请展开包含第一个记录的帧）。内容类型的值是多少？

1

4. 客户端Hello记录是否包含不重数（也称为“challenge”）？如果是这样，“challenge”的十六进制值是多少？

0x66_df_78_4c_04_8c_d6_04_35_dc_44_89_89_46_99_09

5. 客户端Hello记录是否展示其支持的网络套件？如果是，在第一个列出的套件中，公钥算法、对称密钥算法和哈希算法是什么？

RSA\
RC4\
MD5

## 服务器 Hello 记录

6. 找到服务器SSL Hello记录。此记录是否指定所选的加密套件？所选加密套件中的算法是什么？

是\
RSA、RC4和MD5

7. 此记录中有不重数吗？如果是，它的长度是什么？SSL中客户端和服务器不重数的用途是什么？

有\
32个字节\
生成前主密钥和防止“连接重放”攻击

8. 此记录是否包含会话ID？会话ID的用途是什么？

是\
作为会话标识，使得连接能够被重用。在会话恢复过程中会用到该字段，此时会话ID不为0。

9. 此记录包含证书，还是包含在单独的记录中。证书是否能被装入单个以太网帧？

包含在单独的记录中\
不能

## 客户端密钥交换记录

10. 找到客户端密钥交换记录。此记录是否包含前主密钥？这个密钥是用来做什么的？密钥被加密了吗？如果是，它是怎么被加密的？被加密的密钥有多长？

## 更换密钥规范记录（客户端发送）和加密的握手记录

11. 更换密钥规范记录的作用是什么？该记录有多少字节？

客户端告知服务器，客户端已经生成了主密钥，并且后续的通信将使用该密钥进行加密。\
6个字节

12. 在加密的握手记录中，加密的是什么？怎么加密的？

一个握手请求消息\
使用主密钥和选择的算法套件进行加密

13. 服务器是否也向客户端发送更换密钥记录和加密的握手记录？这些记录与客户端发送的有何不同？

是\
更换密钥记录是相同的，但加密的握手记录是一个握手响应消息

## 应用数据

14. 如何加密应用程序数据？包含应用程序数据的记录是否包含MAC？Wireshark能区分加密的应用程序数据和MAC吗？

使用主密钥和选定的加密算法进行加密\
是\
不能，因为他们两者被共同加密了

15. 说明您在跟踪中发现的任何其它有趣的东西。

第一个SSL包是SSL v2.0，但其版本字段指示它为SSL v3.0
